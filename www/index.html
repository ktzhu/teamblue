<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />

    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

		<link rel="stylesheet" href="css/jquery/jquery.mobile-1.0rc1.css" />
		
		<!-- iPad/iPhone specific css below, add after your main css >
		<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
		<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
		-->
		
		<!-- If your application is targeting iOS BEFORE 4.0 you MUST put json2.js from http://www.JSON.org/json2.js into your www directory and include it here -->
		<script type="text/javascript" charset="utf-8" src="javascript/phonegap-1.0.0.js"></script>
		<script type="text/javascript" charset="utf-8" src="javascript/logics/ctaapp.js"></script>
		<script type="text/javascript" charset="utf-8" src="javascript/logics/geo.js"></script>
		
		<script type="text/javascript" charset="utf-8" src="javascript/jquery/jquery-1.6.4.js"></script>
		<script type="text/javascript" charset="utf-8" src="javascript/jquery/jquery.mobile-1.0rc1.js"></script>
		
	  <script type="text/javascript" charset="utf-8">
				// If you want to prevent dragging, uncomment this section
			/*
			function preventBehavior(e) 
			{ 
		      e.preventDefault(); 
		    };
			document.addEventListener("touchmove", preventBehavior, false);
			*/
			
			/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
			see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
			for more details -jm */
			/*
			function handleOpenURL(url)
			{
				// TODO: do something with the url passed in.
			}
			*/
		
			function onBodyLoad()
			{		
				//console.log('hello 1');
				/*
				this.lat = 40;
				this.lon = 80;
				
				var ctaDataAccess = new cta.DataAccess();
				console.log(ctaDataAccess.ctadb);
				ctaDataAccess.loadBusStops(onBusStopsReady);
				*/
				document.addEventListener("deviceready",onDeviceReady,false);
			};
			
			/* When this function is called, PhoneGap has been initialized and is ready to roll */
			/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
			see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
			for more details -jm */
			function onDeviceReady()
			{
				// When we commit our code to Git, we must uncomment the following 
				// line!
		        window.location = "jasmine/SpecRunner.html";
				
		        // do your thing!
				//navigator.notification.alert("PhoneGap "+ device.phonegap +" is working on "+ device.name)
				//navigator.geolocation.getCurrentPosition(onPositionSuccess, onError);
				this.lat = 40;
				this.lon = 80;
				
				var ctaDataAccess = new cta.DataAccess();
				console.log(ctaDataAccess.ctadb);
				ctaDataAccess.loadBusStops(onBusStopsReady);
				
			};
			
			function onBusStopsReady(busStops)
			{
				console.log('Ready:'+busStops);
				var ctaUtil = new cta.Utilities();
				var ctaDOM = new cta.DOM();	
				var closeStops = ctaUtil.dFindClosestBusStops(this.lat, this.lon, busStops, 5);
				console.log('Done:'+closeStops);
				document.getElementById('busStopList').innerHTML = 	ctaDOM.renderBusStops(closeStops);
				console.log(document.getElementById('busStopList').innerHTML);
				//return false;	
			};
			
			function onPositionSuccess(position) {
				this.lat = position.coords.latitude;
				this.lon = position.coords.longitude;
				var ctaDataAccess = new cta.DataAccess();
				ctaDataAccess.loadBusStops(onBusStopsReady);
				/*
    alert('Latitude: '          + position.coords.latitude          + '\n' +
          'Longitude: '         + position.coords.longitude         + '\n' +
          'Altitude: '          + position.coords.altitude          + '\n' +
          'Accuracy: '          + position.coords.accuracy          + '\n' +
          'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
          'Heading: '           + position.coords.heading           + '\n' +
          'Speed: '             + position.coords.speed             + '\n' +
          'Timestamp: '         + new Date(position.timestamp)      + '\n');
          */
			};

// onError Callback receives a PositionError object
//
			function onError(error) {
    			alert('code: '    + error.code    + '\n' +
          			  'message: ' + error.message + '\n');
				};


	    </script>
  </head>
  
  <body onload="onBodyLoad();">	  
	  <div data-role="page" id="home">  
	    <div data-role="header">     
	      <h1>Diversey #76</h1>                     
	    </div>         
	    <div data-role="content" class="ui-content" role="main">
	      <div class="content-primary" id="busStopList">
			
		   </div>
	      
	   	</div>     
	  </div>
  </body>
  
</html>